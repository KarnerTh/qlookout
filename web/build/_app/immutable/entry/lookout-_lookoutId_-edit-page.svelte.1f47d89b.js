import{S as T,i as Q,s as R,y as b,a as q,e as x,z as v,c as I,A as L,b as B,d as k,f as j,g as _,B as w,h,F as A,v as z,k as V,l as O,m as U,n as F,D as M,N as G,Q as H,E as J}from"../chunks/index.f49fd5c2.js";import{P as K,g as N,B as W}from"../chunks/PageHeader.b42d5f8a.js";import{p as X}from"../chunks/stores.6683fd3d.js";import{F as Y,a as Z}from"../chunks/FormInputTextArea.2980ceeb.js";import{F as P}from"../chunks/FormInputField.6e32f34e.js";import{L as tt}from"../chunks/LoadingSpinner.1a458fe5.js";import{k as et,m as ot}from"../chunks/svelte-apollo.e94973ad.js";import{u as at}from"../chunks/getLookout.aaa9be5e.js";const nt=et`
  mutation UpdateLookout(
    $id: Int!
    $name: String
    $query: String
    $cron: String
    $notifyLocal: Boolean
    $notifyMail: Boolean
  ) {
    updateLookout(
      id: $id
      data: {
        name: $name
        query: $query
        cron: $cron
        notifyLocal: $notifyLocal
        notifyMail: $notifyMail
      }
    ) {
      id
    }
  }
`,rt=()=>ot(nt);function it(f){let n,a,t,o,i,d,c,m,s,e,l,p,g,S,E;return t=new P({props:{name:"name",value:f[1].data.lookout.name,required:!0,label:"Lookout name",placeholder:"My important query"}}),i=new P({props:{name:"cron",required:!0,value:f[1].data.lookout.cron,label:"Cron expression",placeholder:"0 7 * * 1-5"}}),c=new Y({props:{name:"query",required:!0,value:f[1].data.lookout.query,label:"SQL Query",placeholder:"SELECT COUNT(*) FROM something"}}),s=new Z({props:{label:"Notifications",items:[{name:"notifyLocal",title:"Local notification",description:"Only works if run locally",initialValue:f[1].data.lookout.notifyLocal},{name:"notifyMail",title:"Mail notification",initialValue:f[1].data.lookout.notifyMail}]}}),p=new W({props:{title:"Update",type:"submit",leadingIcon:"check"}}),{c(){n=V("form"),a=V("div"),b(t.$$.fragment),o=q(),b(i.$$.fragment),d=q(),b(c.$$.fragment),m=q(),b(s.$$.fragment),e=q(),l=V("div"),b(p.$$.fragment),this.h()},l(r){n=O(r,"FORM",{method:!0,class:!0});var $=U(n);a=O($,"DIV",{class:!0});var u=U(a);v(t.$$.fragment,u),o=I(u),v(i.$$.fragment,u),d=I(u),v(c.$$.fragment,u),m=I(u),v(s.$$.fragment,u),e=I(u),l=O(u,"DIV",{class:!0});var y=U(l);v(p.$$.fragment,y),y.forEach(h),u.forEach(h),$.forEach(h),this.h()},h(){F(l,"class","mt-4 mx-3 w-full flex flex-row-reverse"),F(a,"class","flex flex-wrap -mx-3 mb-6"),F(n,"method","POST"),F(n,"class","w-full max-w-lg")},m(r,$){B(r,n,$),M(n,a),L(t,a,null),M(a,o),L(i,a,null),M(a,d),L(c,a,null),M(a,m),L(s,a,null),M(a,e),M(a,l),L(p,l,null),g=!0,S||(E=G(n,"submit",H(f[3])),S=!0)},p(r,$){const u={};$&2&&(u.value=r[1].data.lookout.name),t.$set(u);const y={};$&2&&(y.value=r[1].data.lookout.cron),i.$set(y);const C={};$&2&&(C.value=r[1].data.lookout.query),c.$set(C);const D={};$&2&&(D.items=[{name:"notifyLocal",title:"Local notification",description:"Only works if run locally",initialValue:r[1].data.lookout.notifyLocal},{name:"notifyMail",title:"Mail notification",initialValue:r[1].data.lookout.notifyMail}]),s.$set(D)},i(r){g||(_(t.$$.fragment,r),_(i.$$.fragment,r),_(c.$$.fragment,r),_(s.$$.fragment,r),_(p.$$.fragment,r),g=!0)},o(r){k(t.$$.fragment,r),k(i.$$.fragment,r),k(c.$$.fragment,r),k(s.$$.fragment,r),k(p.$$.fragment,r),g=!1},d(r){r&&h(n),w(t),w(i),w(c),w(s),w(p),S=!1,E()}}}function lt(f){let n,a,t;return a=new tt({}),{c(){n=V("div"),b(a.$$.fragment),this.h()},l(o){n=O(o,"DIV",{class:!0});var i=U(n);v(a.$$.fragment,i),i.forEach(h),this.h()},h(){F(n,"class","flex justify-center pt-9")},m(o,i){B(o,n,i),L(a,n,null),t=!0},p:J,i(o){t||(_(a.$$.fragment,o),t=!0)},o(o){k(a.$$.fragment,o),t=!1},d(o){o&&h(n),w(a)}}}function st(f){let n,a,t,o,i,d;n=new K({props:{title:"Update Lookout",backAction:f[4]}});const c=[lt,it],m=[];function s(e,l){return e[1].loading?0:e[1].data?1:-1}return~(t=s(f))&&(o=m[t]=c[t](f)),{c(){b(n.$$.fragment),a=q(),o&&o.c(),i=x()},l(e){v(n.$$.fragment,e),a=I(e),o&&o.l(e),i=x()},m(e,l){L(n,e,l),B(e,a,l),~t&&m[t].m(e,l),B(e,i,l),d=!0},p(e,[l]){const p={};l&1&&(p.backAction=e[4]),n.$set(p);let g=t;t=s(e),t===g?~t&&m[t].p(e,l):(o&&(z(),k(m[g],1,1,()=>{m[g]=null}),j()),~t?(o=m[t],o?o.p(e,l):(o=m[t]=c[t](e),o.c()),_(o,1),o.m(i.parentNode,i)):o=null)},i(e){d||(_(n.$$.fragment,e),_(o),d=!0)},o(e){k(n.$$.fragment,e),k(o),d=!1},d(e){w(n,e),e&&h(a),~t&&m[t].d(e),e&&h(i)}}}function ut(f,n,a){let t,o;A(f,X,s=>a(0,t=s));const i=at(+t.params.lookoutId);A(f,i,s=>a(1,o=s));const d=rt();return[t,o,i,async s=>{var $,u,y;const e=new FormData(s.target),l=($=e.get("name"))==null?void 0:$.toString(),p=(u=e.get("cron"))==null?void 0:u.toString(),g=(y=e.get("query"))==null?void 0:y.toString(),S=e.has("notifyLocal"),E=e.has("notifyMail");if((await d({variables:{id:+t.params.lookoutId,name:l,cron:p,query:g,notifyMail:E,notifyLocal:S}})).errors){alert("Something went wrong");return}N(`/lookout/${t.params.lookoutId}`,{state:{refetch:!0}})},()=>N(`/lookout/${t.params.lookoutId}`)]}class _t extends T{constructor(n){super(),Q(this,n,ut,st,R,{})}}export{_t as default};
