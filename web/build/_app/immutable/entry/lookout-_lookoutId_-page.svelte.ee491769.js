import{S,i as A,s as Q,y as E,z as T,A as L,g as y,d as D,B as q,k,q as N,a as C,l as v,m as b,r as H,h as f,c as V,n as w,b as _,D as I,u as j,F as z,e as G,f as U,v as W,E as X}from"../chunks/index.f49fd5c2.js";import{B as J,g as P,P as Y,a as Z}from"../chunks/PageHeader.b42d5f8a.js";import{p as K}from"../chunks/stores.6683fd3d.js";import{D as tt}from"../chunks/DialogButton.de2a1bbd.js";import{L as et}from"../chunks/LoadingSpinner.1a458fe5.js";import{k as ot,m as rt}from"../chunks/svelte-apollo.e94973ad.js";import{u as nt}from"../chunks/getLookout.aaa9be5e.js";import{C as F}from"../chunks/Card.a6e88971.js";import{T as lt}from"../chunks/Table.2a8d44c2.js";const at=ot`
  mutation DeleteLookout(
    $id: Int!
  ) {
    deleteLookout(
      id: $id
    ) {
      id
    }
  }
`,st=()=>rt(at);function ut(l){let t,r=l[0].name+"",e,o,a,c=l[0].cron+"",i,u,$,n,m,d,h=l[1].join(", ")+"",x;return{c(){t=k("h5"),e=N(r),o=C(),a=k("p"),i=N(c),u=C(),$=k("h6"),n=N("Notifications"),m=C(),d=k("p"),x=N(h),this.h()},l(p){t=v(p,"H5",{class:!0});var s=b(t);e=H(s,r),s.forEach(f),o=V(p),a=v(p,"P",{class:!0});var g=b(a);i=H(g,c),g.forEach(f),u=V(p),$=v(p,"H6",{class:!0});var B=b($);n=H(B,"Notifications"),B.forEach(f),m=V(p),d=v(p,"P",{class:!0});var R=b(d);x=H(R,h),R.forEach(f),this.h()},h(){w(t,"class","mb-2 text-lg font-medium leading-tight text-neutral-800"),w(a,"class","text-sm text-neutral-600"),w($,"class","mb-2 mt-4 text-lg font-medium leading-tight text-neutral-800"),w(d,"class","text-sm text-neutral-600 flex")},m(p,s){_(p,t,s),I(t,e),_(p,o,s),_(p,a,s),I(a,i),_(p,u,s),_(p,$,s),I($,n),_(p,m,s),_(p,d,s),I(d,x)},p(p,s){s&1&&r!==(r=p[0].name+"")&&j(e,r),s&1&&c!==(c=p[0].cron+"")&&j(i,c),s&2&&h!==(h=p[1].join(", ")+"")&&j(x,h)},d(p){p&&f(t),p&&f(o),p&&f(a),p&&f(u),p&&f($),p&&f(m),p&&f(d)}}}function it(l){let t,r;return t=new F({props:{$$slots:{default:[ut]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,o){L(t,e,o),r=!0},p(e,[o]){const a={};o&7&&(a.$$scope={dirty:o,ctx:e}),t.$set(a)},i(e){r||(y(t.$$.fragment,e),r=!0)},o(e){D(t.$$.fragment,e),r=!1},d(e){q(t,e)}}}function ft(l,t,r){let{lookout:e}=t,o=[];return l.$$set=a=>{"lookout"in a&&r(0,e=a.lookout)},l.$$.update=()=>{l.$$.dirty&3&&(r(1,o=[]),e.notifyLocal&&o.push("Local"),e.notifyMail&&o.push("Mail"))},[e,o]}class ct extends S{constructor(t){super(),A(this,t,ft,it,Q,{lookout:0})}}function $t(l){let t,r,e,o,a,c;return{c(){t=k("h5"),r=N("Query"),e=C(),o=k("div"),a=k("code"),c=N(l[0]),this.h()},l(i){t=v(i,"H5",{class:!0});var u=b(t);r=H(u,"Query"),u.forEach(f),e=V(i),o=v(i,"DIV",{class:!0});var $=b(o);a=v($,"CODE",{class:!0});var n=b(a);c=H(n,l[0]),n.forEach(f),$.forEach(f),this.h()},h(){w(t,"class","mb-2 text-lg font-medium leading-tight text-neutral-800"),w(a,"class","text-sm text-neutral-600"),w(o,"class","max-h-80 overflow-auto")},m(i,u){_(i,t,u),I(t,r),_(i,e,u),_(i,o,u),I(o,a),I(a,c)},p(i,u){u&1&&j(c,i[0])},d(i){i&&f(t),i&&f(e),i&&f(o)}}}function mt(l){let t,r;return t=new F({props:{$$slots:{default:[$t]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,o){L(t,e,o),r=!0},p(e,[o]){const a={};o&3&&(a.$$scope={dirty:o,ctx:e}),t.$set(a)},i(e){r||(y(t.$$.fragment,e),r=!0)},o(e){D(t.$$.fragment,e),r=!1},d(e){q(t,e)}}}function pt(l,t,r){let{query:e}=t;return l.$$set=o=>{"query"in o&&r(0,e=o.query)},[e]}class dt extends S{constructor(t){super(),A(this,t,pt,mt,Q,{query:0})}}const _t=l=>{let t="";return l.exactValue?t=`=${l.exactValue}`:l.shouldBeNull?t="null":l.lessThan&&l.greaterThan?t=`${l.greaterThan} - ${l.lessThan}`:l.lessThan?t=`<${l.lessThan}`:l.greaterThan&&(t=`>${l.greaterThan}`),{id:l.id,data:[{type:"text",value:l.columnName},{type:"text",value:l.columnType},{type:"number",value:l.rowIndex},{type:"text",value:t}]}};function gt(l){let t,r,e,o,a,c,i,u,$;return a=new J({props:{title:"Add rule",leadingIcon:"plus"}}),a.$on("click",l[3]),u=new lt({props:{columns:["Column name","Column type","Row index","Rule"],rows:l[0].map(l[4])}}),u.$on("rowClicked",l[5]),{c(){t=k("div"),r=k("h5"),e=N("Rules"),o=C(),E(a.$$.fragment),c=C(),i=k("div"),E(u.$$.fragment),this.h()},l(n){t=v(n,"DIV",{class:!0});var m=b(t);r=v(m,"H5",{class:!0});var d=b(r);e=H(d,"Rules"),d.forEach(f),o=V(m),T(a.$$.fragment,m),m.forEach(f),c=V(n),i=v(n,"DIV",{class:!0});var h=b(i);T(u.$$.fragment,h),h.forEach(f),this.h()},h(){w(r,"class","mb-2 text-lg font-medium leading-tight text-neutral-800"),w(t,"class","flex mb-2 justify-between"),w(i,"class","max-h-80 overflow-auto")},m(n,m){_(n,t,m),I(t,r),I(r,e),I(t,o),L(a,t,null),_(n,c,m),_(n,i,m),L(u,i,null),$=!0},p(n,m){const d={};m&1&&(d.rows=n[0].map(n[4])),u.$set(d)},i(n){$||(y(a.$$.fragment,n),y(u.$$.fragment,n),$=!0)},o(n){D(a.$$.fragment,n),D(u.$$.fragment,n),$=!1},d(n){n&&f(t),q(a),n&&f(c),n&&f(i),q(u)}}}function ht(l){let t,r;return t=new F({props:{$$slots:{default:[gt]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,o){L(t,e,o),r=!0},p(e,[o]){const a={};o&67&&(a.$$scope={dirty:o,ctx:e}),t.$set(a)},i(e){r||(y(t.$$.fragment,e),r=!0)},o(e){D(t.$$.fragment,e),r=!1},d(e){q(t,e)}}}function kt(l,t,r){let e;z(l,K,$=>r(1,e=$));let{rules:o}=t;const a=$=>{P(`/lookout/${e.params.lookoutId}/rule/${$}/edit`)},c=()=>P(`/lookout/${e.params.lookoutId}/rule/create`),i=$=>_t($),u=$=>a($.detail.id);return l.$$set=$=>{"rules"in $&&r(0,o=$.rules)},[o,e,a,c,i,u]}class vt extends S{constructor(t){super(),A(this,t,kt,ht,Q,{rules:0})}}function bt(l){let t,r,e,o,a,c,i,u,$,n,m,d,h,x,p;return r=new J({props:{title:"Edit",leadingIcon:"pencil"}}),r.$on("click",l[5]),o=new tt({props:{buttonText:"Delete",buttonIcon:"trash",buttonType:"red",dialogTitle:"Delete Lookout",dialogDescription:"Do you realy want to delete this lookout? This action cannot be undone and all related data will be lost",actionButtons:[{title:"Cancel",onClick:Dt},{title:"Delete",buttonType:"red",onClick:l[6]}]}}),u=new ct({props:{lookout:l[1].data.lookout}}),m=new dt({props:{query:l[1].data.lookout.query}}),x=new vt({props:{rules:l[1].data.lookout.rules}}),{c(){t=k("div"),E(r.$$.fragment),e=C(),E(o.$$.fragment),a=C(),c=k("div"),i=k("div"),E(u.$$.fragment),$=C(),n=k("div"),E(m.$$.fragment),d=C(),h=k("div"),E(x.$$.fragment),this.h()},l(s){t=v(s,"DIV",{class:!0});var g=b(t);T(r.$$.fragment,g),e=V(g),T(o.$$.fragment,g),g.forEach(f),a=V(s),c=v(s,"DIV",{class:!0});var B=b(c);i=v(B,"DIV",{class:!0});var R=b(i);T(u.$$.fragment,R),R.forEach(f),$=V(B),n=v(B,"DIV",{class:!0});var M=b(n);T(m.$$.fragment,M),M.forEach(f),B.forEach(f),d=V(s),h=v(s,"DIV",{class:!0});var O=b(h);T(x.$$.fragment,O),O.forEach(f),this.h()},h(){w(t,"class","mb-2 flex gap-2"),w(i,"class","max-w-sm"),w(n,"class","grow"),w(c,"class","flex flex-wrap gap-2"),w(h,"class","mt-2")},m(s,g){_(s,t,g),L(r,t,null),I(t,e),L(o,t,null),_(s,a,g),_(s,c,g),I(c,i),L(u,i,null),I(c,$),I(c,n),L(m,n,null),_(s,d,g),_(s,h,g),L(x,h,null),p=!0},p(s,g){const B={};g&2&&(B.lookout=s[1].data.lookout),u.$set(B);const R={};g&2&&(R.query=s[1].data.lookout.query),m.$set(R);const M={};g&2&&(M.rules=s[1].data.lookout.rules),x.$set(M)},i(s){p||(y(r.$$.fragment,s),y(o.$$.fragment,s),y(u.$$.fragment,s),y(m.$$.fragment,s),y(x.$$.fragment,s),p=!0)},o(s){D(r.$$.fragment,s),D(o.$$.fragment,s),D(u.$$.fragment,s),D(m.$$.fragment,s),D(x.$$.fragment,s),p=!1},d(s){s&&f(t),q(r),q(o),s&&f(a),s&&f(c),q(u),q(m),s&&f(d),s&&f(h),q(x)}}}function wt(l){let t,r,e;return r=new et({}),{c(){t=k("div"),E(r.$$.fragment),this.h()},l(o){t=v(o,"DIV",{class:!0});var a=b(t);T(r.$$.fragment,a),a.forEach(f),this.h()},h(){w(t,"class","flex justify-center pt-9")},m(o,a){_(o,t,a),L(r,t,null),e=!0},p:X,i(o){e||(y(r.$$.fragment,o),e=!0)},o(o){D(r.$$.fragment,o),e=!1},d(o){o&&f(t),q(r)}}}function yt(l){let t,r,e,o,a,c;t=new Y({props:{title:"Lookout Detail",backAction:l[4]}});const i=[wt,bt],u=[];function $(n,m){return n[1].loading?0:n[1].data?1:-1}return~(e=$(l))&&(o=u[e]=i[e](l)),{c(){E(t.$$.fragment),r=C(),o&&o.c(),a=G()},l(n){T(t.$$.fragment,n),r=V(n),o&&o.l(n),a=G()},m(n,m){L(t,n,m),_(n,r,m),~e&&u[e].m(n,m),_(n,a,m),c=!0},p(n,[m]){let d=e;e=$(n),e===d?~e&&u[e].p(n,m):(o&&(W(),D(u[d],1,1,()=>{u[d]=null}),U()),~e?(o=u[e],o?o.p(n,m):(o=u[e]=i[e](n),o.c()),y(o,1),o.m(a.parentNode,a)):o=null)},i(n){c||(y(t.$$.fragment,n),y(o),c=!0)},o(n){D(t.$$.fragment,n),D(o),c=!1},d(n){q(t,n),n&&f(r),~e&&u[e].d(n),n&&f(a)}}}const Dt=function(){};function It(l,t,r){let e,o;z(l,K,d=>r(0,e=d));const a=+e.params.lookoutId,c=nt(a);z(l,c,d=>r(1,o=d));const i=st();Z(()=>{history.state.refetch&&c.refetch()});const u=async()=>{if((await i({variables:{id:a}})).errors){alert("Something went wrong");return}P("/lookout",{state:{refetch:!0}})};return[e,o,c,u,()=>P("/lookout"),()=>P(`/lookout/${e.params.lookoutId}/edit`),function(){u()}]}class Nt extends S{constructor(t){super(),A(this,t,It,yt,Q,{})}}export{Nt as default};
